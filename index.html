<!DOCTYPE html>
<html lang="en">

<head>
  <meta chartset="UTF-8">
  <meta name="viewport" conetent="width=device-width, initia-scale=1">
  <title>Your Farm</title>
  <link href="http://fonts.googleapis.com/css?family=Roboto:400,100" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css'>
  <script src='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js'></script>
</head>

<body>
  <!-- main container-->
  <div class="ui container">

    <!-- header -->
    <header>
      <div style="margin: 10px;">
        <h1>Robotics<br><span style="color:#91ddac; font-size: large;">SmartFarm</span></h1>
      </div>
    </header>
    <hr>

    <!-- Status -->
    <br>

    <div class="row">
      <div style="display: flex; justify-content: center; text-align: center">
        <h2>Status</h2>
      </div>
      <br><br>

      <!-- Cards -->
      <div style="display: flex; justify-content: center; text-align: center" class="ui link cards">

        <div class="card">
          <img src="./images/meter_4.png" alt="temperature image" id="temperature_image">
          <div class="content">
            <div class="header" id="temperature">Ready</div>
            <div class="meta">
              <a>Temperature</a>
            </div>
          </div>
        </div>

        <div class="card">
          <img src="./images/meter_3.png" alt="humidity image" id="humidity_image">
          <div class="content">
            <div class="header" id="humidity">Ready</div>
            <div class="meta">
              <a>Humidity</a>
            </div>
          </div>
        </div>

        <div class="card">
          <img src="./images/meter_1.png" alt="moisture image" id="moisture_image">
          <div class="content">
            <div class="header" id="moisture">Ready</div>
            <div class="meta">
              <a>Moisture</a>
            </div>
          </div>
        </div>

      </div>

      <!--Detail-->
      <br><br>
      
      <div style="display: flex; justify-content: center; text-align: center" class="row">
        <a href="detail_status.html" class="ui right labeled icon button" style="border: 1px solid #d6d6d667; background: white; color: #a4afaa" >
          Show Detail
          <i class="right arrow icon"></i>
          
        </a>
      </div>

    </div>


    <br><br>

    <hr>

    <!-- Control -->
    <div class="row">
      <br>
      <div style="display: flex; justify-content: center; text-align: center">
        <h2>Control</h2>
      </div>
      <br><br>

      <!--Auto/Manual-->
      <div class="row" style="display: flex; justify-content: center; text-align: center;">
        <div class="column">
          <img src="./images/auto_on.png" alt="mode image" id="mode_image">

          <br><br><br>

          <input class="ui button" type="button" id="auto_button" value="AUTO">
        </div>
      </div>

      <!-- Each Section -->
      <br><br><br>
      <div class="ui three column grid" id="mode" style="display: none; text-align: center;">
        <!-- LED -->
        <div class="column">
          <img src="./images/led_off.png" alt="led image" id="led_image">

          <br><br>

          <label class="switch">
            <input type="checkbox" id="led_button">
            <span class="slider round"></span>
          </label>
        </div>



        <!-- PUMP -->
        <div class="column">
          <img src="./images/pump_off.png" alt="pump image" id="pump_image">

          <br><br>

          <label class="switch">
            <input type="checkbox" id="pump_button">
            <span class="slider round"></span>
          </label>
        </div>


        <!-- FAN -->
        <div class="column">
          <img src="./images/fan_off.png" alt="fan image" id="fan_image">

          <br><br>

          <label class="switch">
            <input type="checkbox" id="fan_button">
            <span class="slider round"></span>
          </label>
        </div>

      </div>

    </div>

    <!-- Footer -->
    <br><br><br>
    <footer>
      <p>&copy; 2022 Robotics </p>
    </footer>

  </div>

  <script>
    var requestURL = 'https://api.thingspeak.com/channels/1651803/feeds.json?results=1';
    var request = new XMLHttpRequest();
    request.open('GET', requestURL);
    request.responseType = 'json';
    request.send();
    request.onload = function() {
      var statusdata = request.response;
      var temperaturedata=parseInt(statusdata["feeds"][0]["field1"])
      var humiditydata=parseInt(statusdata["feeds"][0]["field2"])
      var moisturedata=parseInt(statusdata["feeds"][0]["field3"])
      var moisturepdata=100-parseInt(moisturedata/1024*100)
      $('#temperature').html(temperaturedata+" ÂºC");
      $('#humidity').html(humiditydata+" %");
      $('#moisture').html(moisturepdata+" %");
    }
    
    window.open('http://220.149.85.155:8002/AUTO=ON', 'windowPop', 'width=350, height=600, left=400, top=400');
    // Auto/Manual Switch
    $('input:button[id="auto_button"]').click(function () {
      if (document.getElementById("auto_button").value == 'AUTO') {
        document.getElementById("auto_button").value = 'MANUAL';
        document.getElementById("mode_image").src = "./images/auto_off.png";
        document.getElementById("mode").style.display = "";
        window.open('http://220.149.85.155:8002/AUTO=OFF', 'windowPop', 'width=350, height=600, left=400, top=400');
      }
      else {
        document.getElementById("auto_button").value = 'AUTO';
        document.getElementById("mode_image").src = "./images/auto_on.png";
        document.getElementById("mode").style.display = "none";
        window.open('http://220.149.85.155:8002/AUTO=ON', 'windowPop', 'width=350, height=600, left=400, top=400');
      }
    });

    // LED Switch
    $('input:checkbox[id="led_button"]').click(function () {
      if (document.getElementById("led_button").checked == true) {
        document.getElementById("led_button").checked = true;
        document.getElementById("led_image").src = "./images/led_on.png";
        window.open('http://220.149.85.155:8002/LED=ON', 'windowPop', 'width=350, height=600, left=400, top=400');
      }
      else {
        document.getElementById("led_button").checked = false;
        document.getElementById("led_image").src = "./images/led_off.png";
        window.open('http://220.149.85.155:8002/LED=OFF', 'windowPop', 'width=350, height=600, left=400, top=400');

      }
    });

    // Watering Switch
    $('input:checkbox[id="pump_button"]').click(function () {
      console.log("hello")
      document.getElementById("pump_button").checked = true;
      document.getElementById("pump_image").src = "./images/pump_on.png";
      console.log(document.getElementById("led_image"))
      window.open('http://220.149.85.155:8002/PUMP=ON', 'windowPop', 'width=350, height=600, left=400, top=400');
      setTimeout(function () { }, 5000);
      setTimeout(
        function () {
          document.getElementById("pump_button").checked = false;
          document.getElementById("pump_image").src = "./images/pump_off.png";
          window.open('http://220.149.85.155:8002/PUMP=OFF', 'windowPop', 'width=350, height=600, left=400, top=400');
        }, 5000);
    });

    // Fan Switch
    $('input:checkbox[id="fan_button"]').click(function () {
      if (document.getElementById("fan_button").checked == true) {
        document.getElementById("fan_button").checked = true;
        document.getElementById("fan_image").src = "./images/fan_on.png";
        window.open('http://220.149.85.155:8002/FAN=ON', 'windowPop', 'width=350, height=600, left=400, top=400');
      }
      else {
        document.getElementById("fan_button").checked = false;
        document.getElementById("fan_image").src = "./images/fan_off.png";
        window.open('http://220.149.85.155:8002/FAN=OFF', 'windowPop', 'width=350, height=600, left=400, top=400');
      }
    });

  </script>
</body>

</html>